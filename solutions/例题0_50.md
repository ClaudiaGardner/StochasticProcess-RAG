# 例题0.50

## 题目

产生n 维球内均匀分布的点。 0.5.7 概率应用

## 解答

**Formulating a Plan**

The analysis is progressing well, with the framework for the "Analysis" section firmly in place. I'm focusing on concisely presenting the problem's core requirements, key definitions like the n-ball, and the fundamental concepts needed to solve it. I'm aiming for clarity in describing the task.


### 题目分析

本题要求给出一个算法或数学构造，用于生成在 $n$ 维单位球体 $B_n = \{ \mathbf{x} \in \mathbb{R}^n : \|\mathbf{x}\| \le 1 \}$ 内部均匀分布的随机向量。
题目涉及的核心数学概念包括：
1.  **多元连续型随机变量的变换**：如何从简单的分布（如均匀分布、正态分布）构造复杂的联合分布。
2.  **球对称性（Isotropy）**：利用标准正态分布的旋转不变性生成均匀方向。
3.  **径向分布（Radial Distribution）**：推导均匀分布点到原点的距离所服从的概率分布。

本题的目标是找到一个随机向量 $\mathbf{X}$ 的构造表达式，使其概率密度函数在球内为常数，球外为 0。

### 解题过程

要在 $n$ 维单位球内产生均匀分布的点，我们可以将该问题分解为两个独立的步骤：
1.  产生一个在 $n$ 维单位球面 $S^{n-1}$ 上均匀分布的方向向量。
2.  产生一个符合特定分布的径向距离（半径），使得点在体积上的分布是均匀的。

#### 第一步：生成均匀方向

考虑 $n$ 个相互独立的标准正态随机变量 $Z_1, Z_2, \dots, Z_n$，即 $Z_i \sim N(0, 1)$。
构成的随机向量 $\mathbf{Z} = (Z_1, Z_2, \dots, Z_n)^T$ 的联合概率密度函数为：
$$
f_{\mathbf{Z}}(\mathbf{z}) = \prod_{i=1}^n \frac{1}{\sqrt{2\pi}} e^{-z_i^2/2} = (2\pi)^{-n/2} e^{-\frac{1}{2} \sum_{i=1}^n z_i^2} = (2\pi)^{-n/2} e^{-\frac{1}{2} \|\mathbf{z}\|^2}
$$
观察可知，该密度函数仅依赖于向量的模长 $\|\mathbf{z}\|$，而与方向无关。这意味着 $\mathbf{Z}$ 具有球对称性（旋转不变性）。

因此，归一化后的向量 $\mathbf{D}$ 在单位球面 $S^{n-1}$ 上是均匀分布的：
$$
\mathbf{D} = \frac{\mathbf{Z}}{\|\mathbf{Z}\|} = \frac{(Z_1, \dots, Z_n)^T}{\sqrt{Z_1^2 + \dots + Z_n^2}}
$$

#### 第二步：生成径向距离

设 $R$ 为球内均匀分布点到原点的距离（随机变量）。我们需要确定 $R$ 的分布。
对于 $n$ 维球体，半径为 $r$ 的球体积 $V_n(r)$ 与 $r^n$ 成正比，即 $V_n(r) = C_n r^n$，其中 $C_n$ 是与维数有关的常数。

若点在单位球内均匀分布，则其落在半径为 $r$ ($0 \le r \le 1$) 的小球内的概率 $P(R \le r)$ 应等于小球体积与单位球体积之比：
$$
F_R(r) = P(R \le r) = \frac{V_n(r)}{V_n(1)} = \frac{C_n r^n}{C_n 1^n} = r^n, \quad 0 \le r \le 1
$$
我们需要产生一个具有累积分布函数 $F_R(r) = r^n$ 的随机变量 $R$。
利用**逆变换采样法（Inverse Transform Sampling）**：
设 $U$ 为 $(0, 1)$ 上的均匀分布随机变量，即 $U \sim U(0, 1)$。令 $F_R(R) = U$，即：
$$
R^n = U \implies R = U^{1/n}
$$
注意：由于 $U$ 和 $1-U$ 同分布，有时也写作 $(1-U)^{1/n}$，但 $U^{1/n}$ 更为常用。

#### 第三步：合成最终向量

将均匀的方向向量 $\mathbf{D}$ 与正确的径向距离 $R$ 相乘，即可得到在 $n$ 维球内均匀分布的随机向量 $\mathbf{X}$：
$$
\mathbf{X} = R \cdot \mathbf{D} = U^{1/n} \cdot \frac{\mathbf{Z}}{\|\mathbf{Z}\|}
$$

**总结步骤如下**：
1.  生成 $n$ 个独立的标准正态分布随机数 $Z_1, \dots, Z_n \sim N(0, 1)$。
2.  生成 1 个均匀分布随机数 $U \sim U(0, 1)$。
3.  计算归一化因子 $\|\mathbf{Z}\| = \sqrt{\sum_{i=1}^n Z_i^2}$。
4.  计算最终坐标向量 $\mathbf{X} = (X_1, \dots, X_n)$，其中：
$$
X_i = \frac{Z_i}{\|\mathbf{Z}\|} \cdot U^{1/n}, \quad i=1, \dots, n
$$

### 答案

在 $n$ 维单位球内均匀分布的随机点 $\mathbf{X}$ 可通过以下公式生成：

$$
\mathbf{X} = U^{1/n} \frac{\mathbf{Z}}{\|\mathbf{Z}\|}
$$

其中：
*   $\mathbf{Z} = (Z_1, \dots, Z_n)^T$ 是由独立同分布的标准正态随机变量构成的向量，$Z_i \sim N(0, 1)$。
*   $U$ 是独立于 $\mathbf{Z}$ 的均匀分布随机变量，$U \sim U(0, 1)$。
*   $\|\mathbf{Z}\| = \sqrt{Z_1^2 + \dots + Z_n^2}$ 是欧几里得范数。

### 知识延伸

1.  **Muller 方法**：上述利用正态分布生成球面上均匀点的方法被称为 Muller 方法（或 Normal-deviate method）。这是生成高维球面均匀分布最通用的方法。
2.  **维度灾难与拒绝采样**：
    *   在低维（如 $n=2, 3$）时，可以使用**拒绝采样法**：在一个包围球体的超立方体内产生均匀点，若点在球外则丢弃。
    *   但在高维情况下，球体体积与外切超立方体体积之比 $\frac{V_{\text{ball}}}{V_{\text{cube}}} \to 0$ 当 $n \to \infty$。例如 $n=10$ 时，该比率约为 $0.0025$。这意味着拒绝采样法的效率会随维度增加呈指数级下降，因此必须使用本题所述的极坐标变换法。
3.  **常见易错点**：
    *   **错误做法**：直接令半径 $R \sim U(0, 1)$。
    *   **后果**：如果 $R$ 是均匀分布的，生成的点会聚集在球心附近。因为在 $n$ 维空间中，大部分体积都集中在表面附近（壳层），半径必须服从 $f_R(r) = n r^{n-1}$ 才能抵消体积效应。
4.  **相关公式**：
    *   $n$ 维球体体积：$V_n = \frac{\pi^{n/2}}{\Gamma(\frac{n}{2} + 1)} R^n$。
    *   $n$ 维球面面积：$S_{n-1} = \frac{2\pi^{n/2}}{\Gamma(\frac{n}{2})} R^{n-1}$。

---
