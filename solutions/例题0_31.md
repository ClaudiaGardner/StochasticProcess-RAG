# 例题0.31

## 题目

生日悖论：把n 个球放进M 个箱子，有一个箱子内球数超过1 的概率。

## 解答

**Defining the Approach**

\n\n

I'm currently focused on precisely defining the problem's parameters: $n$ balls, $M$ bins, seeking the probability of a "collision." My analysis now includes clear symbolic representations and the core concepts, specifically combinatorics, and the complementary event. I'm crafting the "Problem Analysis" section now. I am also planning the detailed mathematical derivation.


### 题目分析
本题考查的是经典的**古典概型**与**组合数学**问题。题目中的 $n$ 代表球的数量（对应生日问题中的人数），$M$ 代表箱子的数量（对应一年中的天数，通常为365）。核心概念是利用**补集思想**（Complementary Counting）来计算概率。直接计算“至少有一个箱子球数超过1”的情况非常复杂，因为这包含了恰好有一个箱子有2个球、有3个球、或者多个箱子有多个球等多种互斥情况。因此，解题的关键在于先计算对立事件——“所有箱子内的球数都不超过1”（即所有球都在不同的箱子内）的概率，然后用1减去该概率。

### 解题过程

我们将问题转化为：将 $n$ 个可区分的球放入 $M$ 个可区分的箱子中，求至少有一个箱子中球的数量大于等于2的概率 $P$。

**步骤 1：确定样本空间的总数**
每个球都有 $M$ 种选择（可以放入 $M$ 个箱子中的任意一个）。由于共有 $n$ 个球，且球的放置是相互独立的，根据乘法原理，样本空间 $\Omega$ 的样本点总数为：
$$|\Omega| = M \times M \times \cdots \times M = M^n$$

**步骤 2：定义事件与对立事件**
设事件 $A$ 为“有一个箱子内球数超过1”（即发生碰撞）。
设事件 $A^c$ 为“所有箱子内球数都不超过1”（即没有发生碰撞，所有球所在的箱子互不相同）。

根据概率的性质：
$$P(A) = 1 - P(A^c)$$

**步骤 3：计算对立事件的样本点数**
事件 $A^c$ 意味着 $n$ 个球必须放入 $M$ 个不同的箱子中。这要求 $n \le M$（如果 $n > M$，根据鸽巢原理，必然有箱子球数超过1，此时 $P(A)=1$）。
假设 $n \le M$，我们可以按顺序放置球：
- 第1个球有 $M$ 种选择；
- 第2个球为了不与第1个球同箱，有 $M-1$ 种选择；
- 第3个球为了不与前2个球同箱，有 $M-2$ 种选择；
- $\cdots$
- 第 $n$ 个球有 $M-(n-1)$ 种选择。

因此，事件 $A^c$ 包含的样本点数为从 $M$ 个元素中取 $n$ 个元素的排列数 $P_M^n$（或记为 $A_M^n$）：
$$|A^c| = M \times (M-1) \times (M-2) \times \cdots \times (M-n+1) = \frac{M!}{(M-n)!}$$

**步骤 4：计算概率**
对立事件的概率为：
$$P(A^c) = \frac{|A^c|}{|\Omega|} = \frac{M(M-1)\cdots(M-n+1)}{M^n} = \frac{M!}{M^n (M-n)!}$$

也可以写成乘积形式：
$$P(A^c) = \frac{M}{M} \times \frac{M-1}{M} \times \cdots \times \frac{M-n+1}{M} = \prod_{i=0}^{n-1} \left(1 - \frac{i}{M}\right)$$

**步骤 5：得出最终结果**
所求事件 $A$ 的概率为：
$$P(A) = 1 - \frac{M!}{M^n (M-n)!}$$

### 答案
设 $n$ 个球放进 $M$ 个箱子，有一个箱子内球数超过 1 的概率为 $p$，则：
$$p = \begin{cases} 1 - \frac{M!}{M^n(M-n)!} & \text{若 } n \le M \\ 1 & \text{若 } n > M \end{cases}$$

### 知识延伸
1.  **近似公式**：
    当 $n$ 远小于 $M$ 时，利用泰勒展开近似 $e^{-x} \approx 1-x$，可以将上述概率近似为：
    $$P(A^c) = \prod_{i=0}^{n-1} \left(1 - \frac{i}{M}\right) \approx \prod_{i=0}^{n-1} e^{-\frac{i}{M}} = e^{-\sum_{i=0}^{n-1} \frac{i}{M}} = e^{-\frac{n(n-1)}{2M}}$$
    因此，碰撞概率近似为：
    $$P(A) \approx 1 - e^{-\frac{n(n-1)}{2M}}$$
    这一近似公式常用于快速估算。例如在 $M=365$ 时，当 $n=23$，概率约为 $0.5$。

2.  **应用领域**：
    -   **哈希碰撞（Hash Collision）**：在计算机科学中，评估哈希函数发生冲突的概率。
    -   **生日攻击（Birthday Attack）**：密码学中利用该原理寻找哈希碰撞，从而降低暴力破解的复杂度（将复杂度从 $2^k$ 降低到 $2^{k/2}$）。

3.  **易错点**：
    -   混淆“恰好有一个箱子有2个球”与“至少有一个箱子有2个球以上”。本题是后者，必须使用补集法。
    -   误认为球或箱子不可区分。在标准的生日悖论模型中，默认样本空间是基于有序元组的（即球是不同的，箱子也是不同的），这符合麦克斯韦-玻尔兹曼统计。

---
