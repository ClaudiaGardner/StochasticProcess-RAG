# 习题3.7

## 题目

假定球逐个地被分配到8个瓮中，各球以相等的可能放到其中任意一个瓮中。间在分配9次后，其中恰有3个瓮不是空的概率是多少？

## 解答

**Evaluating the Problem**

I've carefully analyzed the problem, modeled it mathematically, and determined the total outcomes and the event of interest. I'm currently drafting the solution steps, including defining the sample space, identifying favorable outcomes via a combinatorial approach and the inclusion-exclusion principle. The formula is now almost complete, with the final fraction in LaTeX format.


### 题目分析
本题属于经典的**占位问题（Occupancy Problem）**或**球盒模型（Balls and Bins Model）**。题目考查的核心概念是**古典概型**与**组合数学**中的**容斥原理**（或第二类斯特林数）。具体来说，需要计算将 $n$ 个可辨球放入 $m$ 个可辨瓮中，使得恰好有 $k$ 个瓮非空的概率。

### 解题过程

**1. 建立数学模型**

设球的个数为 $n=9$，瓮的个数为 $m=8$。
由于球是逐个分配的，且每个球落入任意一个瓮的可能性相等，我们可以将球视为**可辨（distinct）**，瓮也是**可辨（distinct）**的。

**2. 计算样本空间总数**

每一个球都有 8 种选择。由于有 9 个球，且各球的选择是独立的，因此样本空间 $\Omega$ 的总样本点数为：
$$|\Omega| = 8^9$$

**3. 计算有利事件样本数**

设事件 $A$ 为“分配 9 次后，恰有 3 个瓮不是空的”。计算该事件包含的样本点数可以分为两步：

*   **第一步：选出非空的瓮**
    从 8 个瓮中任选 3 个作为非空瓮。选法总数为组合数：
    $$\binom{8}{3} = \frac{8 \times 7 \times 6}{3 \times 2 \times 1} = 56$$

*   **第二步：将球放入选定的瓮中且无空瓮**
    现在的问题转化为：将 9 个不同的球全部放入选定的 3 个不同的瓮中，且每个瓮至少有一个球。这等价于求从 9 个元素的集合到 3 个元素的集合的**满射（Surjection）**函数的个数。

    我们可以使用**容斥原理**来计算这种情况的数量。
    设选定的 3 个瓮为 $U_1, U_2, U_3$。
    - 9 个球任意放入这 3 个瓮的方法数为 $3^9$。
    - 减去至少有 1 个瓮为空的情况：$\binom{3}{1} \times 2^9$（选 1 个瓮为空，球放入其余 2 个）。
    - 加上至少有 2 个瓮为空的情况：$\binom{3}{2} \times 1^9$（选 2 个瓮为空，球放入其余 1 个）。
    - 减去 3 个瓮都为空的情况：$\binom{3}{3} \times 0^9 = 0$。

    因此，将 9 个球放入 3 个瓮且无空瓮的方法数 $N$ 为：
    $$N = 3^9 - \binom{3}{1}2^9 + \binom{3}{2}1^9$$
    $$N = 19683 - 3 \times 512 + 3 \times 1$$
    $$N = 19683 - 1536 + 3 = 18150$$

    *注：这也等价于 $3! \times S_2(9, 3)$，其中 $S_2(n, k)$ 是第二类斯特林数。*

*   **综合有利样本数**
    事件 $A$ 的样本点总数为选瓮的方法数乘以放球的方法数：
    $$|A| = \binom{8}{3} \times (3^9 - 3 \times 2^9 + 3) = 56 \times 18150 = 1,016,400$$

**4. 计算概率**

根据古典概型公式，所求概率 $P(A)$ 为：
$$P(A) = \frac{|A|}{|\Omega|} = \frac{\binom{8}{3} (3^9 - 3 \cdot 2^9 + 3)}{8^9}$$

代入数值计算：
$$P(A) = \frac{1,016,400}{134,217,728}$$

约分化简（可选，通常保留公式形式即可，若需数值解）：
$$P(A) \approx 0.00757277$$

### 答案
分配 9 次后，其中恰有 3 个瓮不是空的概率为：
$$ \frac{\binom{8}{3} (3^9 - 3 \times 2^9 + 3)}{8^9} $$
或者写作数值形式：
$$ \frac{1,016,400}{134,217,728} \approx 0.00757 $$

### 知识延伸

1.  **一般公式**：
    将 $n$ 个可辨球放入 $m$ 个可辨盒中，恰好有 $k$ 个盒非空的概率公式为：
    $$ P(X=k) = \frac{\binom{m}{k} \sum_{j=0}^{k} (-1)^j \binom{k}{j} (k-j)^n}{m^n} $$
    其中分子部分的求和项 $ \sum_{j=0}^{k} (-1)^j \binom{k}{j} (k-j)^n $ 等于 $k! S_2(n, k)$。

2.  **第二类斯特林数（Stirling Numbers of the Second Kind）**：
    符号 $S_2(n, k)$ 或 $\left\{ \begin{matrix} n \\ k \end{matrix} \right\}$ 表示将 $n$ 个不同元素拆分为 $k$ 个非空集合的方法数。本题中球是不同的，瓮也是不同的，所以需要乘以 $k!$（瓮的排列）。

3.  **易错点**：
    -   **球的可辨性**：题目中“逐个分配”暗示了球是有次序或可区分的。如果球不可区分（Bose-Einstein统计），分母将变为 $\binom{n+m-1}{m-1}$，解法完全不同。
    -   **空瓮的处理**：直接计算“恰好 3 个非空”比较困难，必须先选定哪 3 个，然后利用容斥原理排除掉这 3 个中还有空瓮的情况，不能简单地认为是 $3^9$。

---
