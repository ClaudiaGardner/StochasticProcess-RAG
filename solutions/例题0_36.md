# 例题0.36

## 题目

集优惠券问题：有 n 类不同的优惠券，买 1 件商品可以随机获得其中某类 1 张，问：平均需 要购买多少商品才能集齐？ 0.5.3 概率树，概率转移图，贝叶斯推断

## 解答

**Refining the Solution**

The decomposition into geometric phases is key, and I'm finalizing the LaTeX formatting. I'm ensuring clarity in the definition of $X_i$ and its geometric distribution. The "Markov Chain View" will be a brief footnote, emphasizing the state transitions implied by the coupon collection process. Then, I'll state the answer in both summation and harmonic number forms.


### 题目分析
本题是经典的**集优惠券问题（Coupon Collector's Problem）**。题目中给定 $n$ 种不同的优惠券，每次获取一种，且获取每种优惠券的概率相等（均为 $1/n$）。我们需要求解的是集齐所有 $n$ 种优惠券所需购买商品数量的**数学期望**。本题考查的核心概念包括**几何分布（Geometric Distribution）**的期望、**随机变量的分解**以及**期望的线性性质（Linearity of Expectation）**。虽然题目元数据提及概率树和贝叶斯推断，但解决此题最标准且严谨的方法是利用马尔可夫链的状态转移思想，将总过程分解为若干个独立的几何分布阶段。

### 解题过程

令随机变量 $X$ 表示集齐 $n$ 种优惠券所需购买的商品总数。我们需要求解 $E[X]$。

为了求解 $E[X]$，我们将整个收集过程分解为 $n$ 个阶段。
令 $X_i$ 表示在已经收集了 $i-1$ 种不同优惠券的情况下，为了收集到第 $i$ 种**新**的优惠券所需要购买的商品数量（其中 $i = 1, 2, \dots, n$）。

显然，总购买数量 $X$ 是各阶段购买数量之和：
$$X = X_1 + X_2 + \dots + X_n = \sum_{i=1}^n X_i$$

根据期望的线性性质，总期望等于各阶段期望之和：
$$E[X] = \sum_{i=1}^n E[X_i]$$

接下来分析每一个随机变量 $X_i$ 的分布：

1.  **阶段 1 ($X_1$)**：
    当我们手里有 $0$ 张优惠券时，购买第 1 件商品必然会得到一张新的优惠券（因为任何一张都是新的）。
    获得新优惠券的概率 $p_1 = \frac{n-0}{n} = 1$。
    因此，$X_1 = 1$，且 $E[X_1] = 1$。

2.  **阶段 $i$ ($X_i$)**：
    假设我们已经收集了 $i-1$ 种不同的优惠券。此时，剩余未收集的优惠券种类为 $n - (i-1)$。
    每次购买获得一张**新**优惠券（即属于未收集的那 $n-i+1$ 种）的概率为 $p_i$：
    $$p_i = \frac{n - (i-1)}{n}$$
    
    如果买到的优惠券是已经拥有的（概率为 $1-p_i$），则我们需要继续购买。这是一个典型的**伯努利试验**序列，直到成功为止。因此，$X_i$ 服从参数为 $p_i$ 的**几何分布**，记为 $X_i \sim G(p_i)$。
    
    几何分布的期望公式为 $E[Y] = \frac{1}{p}$，所以：
    $$E[X_i] = \frac{1}{p_i} = \frac{n}{n - i + 1}$$

3.  **求和**：
    将所有阶段的期望相加：
    $$E[X] = \sum_{i=1}^n \frac{n}{n - i + 1}$$
    
    展开该求和公式：
    $$E[X] = \frac{n}{n} + \frac{n}{n-1} + \dots + \frac{n}{2} + \frac{n}{1}$$
    
    提取公因子 $n$，并令求和索引 $j = n - i + 1$（当 $i=1$ 时 $j=n$，当 $i=n$ 时 $j=1$），我们可以将求和重写为调和级数的形式：
    $$E[X] = n \left( \frac{1}{n} + \frac{1}{n-1} + \dots + \frac{1}{1} \right) = n \sum_{k=1}^n \frac{1}{k}$$

### 答案
平均需要购买的商品数量为：
$$ n \sum_{k=1}^n \frac{1}{k} $$

### 知识延伸
1.  **调和级数与渐近估计**：
    上述答案中 $\sum_{k=1}^n \frac{1}{k}$ 被称为第 $n$ 个调和数，记为 $H_n$。当 $n$ 很大时，根据欧拉定理，有如下近似：
    $$H_n \approx \ln n + \gamma$$
    其中 $\gamma \approx 0.577$ 是欧拉-马歇罗尼常数（Euler-Mascheroni constant）。
    因此，集齐 $n$ 种优惠券平均需要的购买次数约为 $n \ln n$。

2.  **几何分布的性质**：
    本题的关键在于识别出从“拥有 $k$ 种”状态转移到“拥有 $k+1$ 种”状态所需的步数服从几何分布。这是马尔可夫链中状态转移时间的典型应用。

3.  **方差计算**：
    由于各阶段 $X_i$ 相互独立，总方差也等于各阶段方差之和：
    $$Var(X) = \sum_{i=1}^n Var(X_i) = \sum_{i=1}^n \frac{1-p_i}{p_i^2} < \frac{\pi^2}{6}n^2$$

4.  **易错点**：
    不要直接用总概率 $1/n$ 去计算期望，必须分阶段考虑，因为随着手中优惠券种类的增加，获得新优惠券的概率在不断降低（难度在增加）。

---
