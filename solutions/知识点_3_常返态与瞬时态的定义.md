# 常返态与瞬时态的定义和判定

# 常返态与瞬时态的定义和判定

## 1. 基本定义

### 1.1 首达时间与首达概率

设 $\{X_n, n \geq 0\}$ 是状态空间为 $S$ 的马尔可夫链。

**首达时间**：从状态 $i$ 首次到达状态 $j$ 的时间定义为
$$T_j^{(i)} = \inf\{n \geq 1: X_n = j | X_0 = i\}$$

**首达概率**：从状态 $i$ 出发最终到达状态 $j$ 的概率
$$f_{ij} = P(T_j^{(i)} < \infty | X_0 = i) = P(\exists n \geq 1: X_n = j | X_0 = i)$$

特别地，$f_{ii}$ 表示从状态 $i$ 出发再次返回状态 $i$ 的概率。

### 1.2 常返态与瞬时态

**常返态（Recurrent State）**：状态 $i$ 称为常返的，如果
$$f_{ii} = 1$$
即从状态 $i$ 出发必然会返回状态 $i$。

**瞬时态（Transient State）**：状态 $i$ 称为瞬时的，如果
$$f_{ii} < 1$$
即从状态 $i$ 出发有正概率永远不再返回状态 $i$。

### 1.3 访问次数

定义状态 $i$ 被访问的总次数为
$$N_i = \sum_{n=1}^{\infty} \mathbb{1}_{\{X_n = i\}}$$

其期望值为
$$E[N_i | X_0 = i] = \sum_{n=1}^{\infty} P(X_n = i | X_0 = i) = \sum_{n=1}^{\infty} p_{ii}^{(n)}$$

其中 $p_{ij}^{(n)} = P(X_n = j | X_0 = i)$ 是 $n$ 步转移概率。

## 2. 核心性质

### 2.1 常返性判别定理

**定理1（访问次数判别法）**：
$$i \text{ 是常返态} \Longleftrightarrow \sum_{n=1}^{\infty} p_{ii}^{(n)} = \infty$$
$$i \text{ 是瞬时态} \Longleftrightarrow \sum_{n=1}^{\infty} p_{ii}^{(n)} < \infty$$

**证明思路**：利用 $E[N_i | X_0 = i] = \frac{f_{ii}}{1-f_{ii}}$ 的关系。

### 2.2 常返态的等价刻画

**定理2**：以下命题等价：
1. 状态 $i$ 是常返的
2. $\sum_{n=1}^{\infty} p_{ii}^{(n)} = \infty$
3. $P(N_i = \infty | X_0 = i) = 1$
4. 从 $i$ 出发，以概率1会无穷多次返回 $i$

### 2.3 类性质

**定理3（常返性的类性质）**：
- 如果 $i$ 是常返态，且 $i \leftrightarrow j$（$i$ 与 $j$ 互通），则 $j$ 也是常返态
- 常返性是闭集的类性质
- 在不可约马尔可夫链中，所有状态要么都是常返的，要么都是瞬时的

### 2.4 正常返与零常返

**定义**：设 $i$ 是常返态，定义平均返回时间
$$\mu_i = E[T_i^{(i)} | X_0 = i] = \sum_{n=1}^{\infty} n \cdot f_{ii}^{(n)}$$

其中 $f_{ii}^{(n)} = P(T_i^{(i)} = n | X_0 = i)$。

- **正常返态（Positive Recurrent）**：$\mu_i < \infty$
- **零常返态（Null Recurrent）**：$\mu_i = \infty$

### 2.5 遍历性定理

**定理4**：对于不可约非周期马尔可夫链：
$$\lim_{n \to \infty} p_{ij}^{(n)} = \begin{cases}
\frac{1}{\mu_j} & \text{若 } j \text{ 是正常返态} \\
0 & \text{若 } j \text{ 是零常返或瞬时态}
\end{cases}$$

## 3. 关键公式

### 3.1 首达概率的递推公式

$$f_{ij}^{(n)} = P(T_j^{(i)} = n) = \sum_{k \neq j} p_{ik} f_{kj}^{(n-1)}, \quad n \geq 2$$

$$f_{ij} = \sum_{n=1}^{\infty} f_{ij}^{(n)}$$

### 3.2 转移概率与首达概率的关系

**Chapman-Kolmogorov方程的推广**：
$$p_{ij}^{(n)} = \sum_{k=1}^{n} f_{ij}^{(k)} p_{jj}^{(n-k)}, \quad n \geq 1$$

特别地，当 $i = j$ 时：
$$p_{ii}^{(n)} = \sum_{k=1}^{n} f_{ii}^{(k)} p_{ii}^{(n-k)}$$

### 3.3 生成函数方法

定义生成函数：
$$P_{ii}(s) = \sum_{n=0}^{\infty} p_{ii}^{(n)} s^n, \quad F_{ii}(s) = \sum_{n=1}^{\infty} f_{ii}^{(n)} s^n$$

则有关系：
$$P_{ii}(s) = \frac{1}{1 - F_{ii}(s)}$$

因此：
$$\sum_{n=1}^{\infty} p_{ii}^{(n)} = \lim_{s \to 1^-} [P_{ii}(s) - 1] = \lim_{s \to 1^-} \frac{F_{ii}(s)}{1 - F_{ii}(s)} = \frac{f_{ii}}{1-f_{ii}}$$

### 3.4 平均返回时间公式

$$\mu_i = \sum_{n=1}^{\infty} n \cdot f_{ii}^{(n)} = \frac{dF_{ii}(s)}{ds}\bigg|_{s=1}$$

若 $i$ 是常返态且存在平稳分布 $\pi$，则：
$$\mu_i = \frac{1}{\pi_i}$$

## 4. 典型例子

### 例1：简单随机游走（一维）

考虑整数集上的简单随机游走：
$$P(X_{n+1} = i+1 | X_n = i) = p, \quad P(X_{n+1} = i-1 | X_n = i) = q = 1-p$$

**问题**：判断状态0的常返性。

**解**：

利用反射原理和组合方法，可以得到：
$$p_{00}^{(2n)} = \binom{2n}{n} p^n q^n$$

使用Stirling公式：$n! \sim \sqrt{2\pi n} \left(\frac{n}{e}\right)^n$

$$p_{00}^{(2n)} \sim \frac{1}{\sqrt{\pi n}} (4pq)^n$$

因此：
$$\sum_{n=1}^{\infty} p_{00}^{(2n)} \sim \sum_{n=1}^{\infty} \frac{(4pq)^n}{\sqrt{\pi n}}$$

**情况1**：$p = q = \frac{1}{2}$（对称随机游走）

$$4pq = 1, \quad \sum_{n=1}^{\infty} \frac{1}{\sqrt{\pi n}} = \infty$$

**结论**：状态0是**常返态**。

**情况2**：$p \neq q$

$$4pq < 1, \quad \sum_{n=1}^{\infty} \frac{(4pq)^n}{\sqrt{\pi n}} < \infty$$

**结论**：状态0是**瞬时态**。

### 例2：二维随机游走

在 $\mathbb{Z}^2$ 上的对称随机游走，每步以概率 $\frac{1}{4}$ 向上下左右移动。

**结果**：
$$p_{00}^{(2n)} = \sum_{k=0}^{n} \binom{n}{k}^2 \left(\frac{1}{4}\right)^{2n} \sim \frac{1}{\pi n}$$

$$\sum_{n=1}^{\infty} p_{00}^{(2n)} \sim \sum_{n=1}^{\infty} \frac{1}{\pi n} = \infty$$

**结论**：原点是**常返态**。

### 例3：三维随机游走

在 $\mathbb{Z}^3$ 上的对称随机游走。

**结果**：
$$p_{00}^{(2n)} \sim \frac{C}{n^{3/2}}$$

$$\sum_{n=1}^{\infty} \frac{1}{n^{3/2}} < \infty$$

**结论**：原点是**瞬时态**。

**Pólya定理**：$d$ 维简单对称随机游走在 $d \leq 2$ 时常返，$d \geq 3$ 时瞬时。

### 例4：具体转移矩阵

考虑三状态马尔可夫链，转移矩阵为：
$$P = \begin{pmatrix}
0.5 & 0.5 & 0 \\
0.3 & 0.4 & 0.3 \\
0 & 0 & 1
\end{pmatrix}$$

**分析**：

状态3：$p_{33} = 1$，这是吸收态，显然 $\sum_{n=1}^{\infty} p_{33}^{(n)} = \infty$，是**常返态**。

状态1和2：计算 $f_{11}$。

从状态1出发，可能的路径：
- 停留在1：概率0.5
- 转到2再回1：需要计算 $f_{21}$

设 $f_{11} = 0.5 + 0.5 f_{21}$

从状态2：$f_{21} = 0.3 + 0.4 f_{21}$

解得：$f_{21} = \frac{0.3}{0.6} = 0.5$

因此：$f_{11} = 0.5 + 0.5 \times 0.5 = 0.75 < 1$

**结论**：状态1和2是**瞬时态**。

## 5. 与其他概念的联系

### 5.1 与马尔可夫链分类的关系

马尔可夫链的状态分类：
$$\text{状态} \begin{cases}
\text{常返态} \begin{cases}
\text{正常返态（遍历态）} \\
\text{零常返态}
\end{cases} \\
\text{瞬时态}
\end{cases}$$

**有限状态空间的重要结论**：
- 有限不可约马尔可夫链中，所有状态都是正常返的
- 不存在零常返态

### 5.2 与平稳分布的关系

**定理**：不可约马尔可夫链存在平稳分布 $\pi$（满足 $\pi P = \pi$）当且仅当所有状态都是正常返的，且：
$$\pi_i = \frac{1}{\mu_i}$$

**推论**：
- 瞬时态或零常返态不可能有平稳分布
- 正常返态必有唯一的平稳分布

### 5.3 与遍历定理的关系

**强大数定律形式**：设 $i$ 是正常返态，则
$$\lim_{n \to \infty} \frac{1}{n} \sum_{k=1}^{n} \mathbb{1}_{\{X_k = i\}} = \frac{1}{\mu_i} \quad \text{a.s.}$$

对于瞬时态或零常返态 $i$：
$$\lim_{n \to \infty} \frac{1}{n} \sum_{k=1}^{n} \mathbb{1}_{\{X_k = i\}} = 0 \quad \text{a.s.}$$

### 5.4 与随机游走的关系

**Gambler's Ruin问题**：

初始资本 $k$，目标 $N$，每次赢的概率 $p$。

破产概率（从 $k$ 到达0的概率）：
$$f_{k0} = \begin{cases}
\frac{1 - (q/p)^k}{1 - (q/p)^N} & \text{若 } p \neq \frac{1}{2} \\
\frac{N-k}{N} & \text{若 } p = \frac{1}{2}
\end{cases}$$

当 $N \to \infty$：
- 若 $p \leq \frac{1}{2}$：$f_{k0} \to 1$（必然破产）
- 若 $p > \frac{1}{2}$：$f_{k0} \to (q/p)^k < 1$（有正概率不破产）

### 5.5 与分支过程的关系

**Galton-Watson分支过程**：设 $Z_n$ 表示第 $n$ 代的个体数。

灭绝概率 $q = P(Z_n = 0 \text{ for some } n | Z_0 = 1)$

**结论**：
- 若 $m = E[\text{后代数}] \leq 1$，则 $q = 1$（状态0常返）
- 若 $m > 1$，则 $q < 1$（状态0瞬时）

## 6. 常见考点与易错点

### 6.1 学习要点

**要点1：判别方法的选择**
- **级数判别法**：计算 $\sum_{n=1}^{\infty} p_{ii}^{(n)}$，适用于能显式计算转移概率的情况
- **首达概率法**：计算 $f_{ii}$，适用于有明确路径结构的情况
- **类性质法**：利用互通关系，适用于复杂网络

**要点2：常返性的层次**
```
常返态 → 判断正常返还是零常返 → 计算平均返回时间
```

**要点3：维度的影响**
- 低维（1D, 2D）：倾向于常返
- 高维（≥3D）：倾向于瞬时

### 6.2 常见错误

**错误1：混淆 $p_{ii}^{(n)}$ 和 $f_{ii}^{(n)}$**

- $p_{ii}^{(n)}$：$n$ 步后在状态 $i$ 的概率（可能中途经过 $i$）
- $f_{ii}^{(n)}$：恰好第 $n$ 步首次返回 $i$ 的概率

**关系**：$p_{ii}^{(n)} = \sum_{k=1}^{n} f_{ii}^{(k)} p_{ii}^{(n-k)}$

**错误2：认为常返态一定有平稳分布**

反例：零常返态是常返的但没有平稳分布。

**错误3：有限状态链中存在瞬时态**

纠正：有限不可约马尔可夫链的所有状态都是正常返的。

但如果链可约，可能有瞬时态（如例4中的状态1、2）。

**错误4：忽略周期性**

常返态可能是周期的，此时 $\lim_{n \to \infty} p_{ii}^{(n)}$ 不存在。

正确判别：$\sum_{n=1}^{\infty} p_{ii}^{(n)} = \infty$ 仍成立。

### 6.3 解题技巧

**技巧1：利用对称性**

对称随机游走中，利用反射原理和组合恒等式。

**技巧2：首达概率方程组**

设置方程：
$$f_{ij} = \sum_{k \in S} p_{ik} \begin{cases}
1 & k = j \\
f_{kj} & k \neq j
\end{cases}$$

**技巧3：生成函数方法**

对于复杂的递推关系，使用生成函数转化为代数方程。

**技巧4：渐近分析**

当精确计算困难时，使用Stirling公式等渐近方法：
$$\binom{2n}{n} \sim \frac{4^n}{\sqrt{\pi n}}$$

**技巧5：图论方法**

将状态转移图分解为强连通分量，分别判断常返性。

### 6.4 典型考题模式

**模式1：给定转移矩阵，判断状态性质**

步骤：
1. 画状态转移图
2. 找出闭集和互通类
3. 对每个类判断常返性
4. 计算平均返回时间（如需要）

**模式2：随机游走变形**

- 带吸收壁的随机游走
- 带反射壁的随机游走  
- 非对称随机游走

**模式3：证明题**

- 证明某类状态是常返的
- 证明常返性的类性质
- 利用常返性证明极限定理

**模式4：计算题**

- 计算首达概率 $f_{ij}$
- 计算平均返回时间 $\mu_i$
- 计算长期占比 $\lim_{n \to \infty} \frac{1}{n}\sum_{k=1}^{n} \mathbb{1}_{\{X_k=i\}}$

---

## 总结

常返态与瞬时态是马尔可夫链理论的核心概念，其判定依据为：

$$\boxed{i \text{ 常返} \Longleftrightarrow \sum_{n=1}^{\infty} p_{ii}^{(n)} = \infty \Longleftrightarrow f_{ii} = 1}$$

理解这一概念的关键在于：
1. 掌握多种等价判别方法
2. 理解常返性的概率意义（无穷次返回）
3. 区分正常返与零常返
4. 联系平稳分布和遍历理论
