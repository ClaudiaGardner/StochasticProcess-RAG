# 马尔可夫链的定义和转移概率矩阵

# 马尔可夫链的定义和转移概率矩阵

## 1. 基本定义

### 1.1 马尔可夫链的定义

**定义1（离散时间马尔可夫链）**：设 $\{X_n, n = 0, 1, 2, \ldots\}$ 是一个随机过程，其状态空间为 $S$（可数集）。若对任意 $n \geq 0$ 和任意状态 $i_0, i_1, \ldots, i_{n-1}, i, j \in S$，只要 $P(X_0=i_0, X_1=i_1, \ldots, X_n=i) > 0$，就有：

$$P(X_{n+1}=j | X_n=i, X_{n-1}=i_{n-1}, \ldots, X_0=i_0) = P(X_{n+1}=j | X_n=i)$$

则称 $\{X_n\}$ 为**马尔可夫链**，上述性质称为**马尔可夫性**或**无记忆性**。

**定义2（齐次马尔可夫链）**：若转移概率与时间 $n$ 无关，即：

$$P(X_{n+1}=j | X_n=i) = P(X_1=j | X_0=i) = p_{ij}, \quad \forall n \geq 0$$

则称该马尔可夫链为**时齐的**或**齐次的**。

### 1.2 转移概率

**一步转移概率**：从状态 $i$ 经过一步转移到状态 $j$ 的概率：

$$p_{ij} = P(X_{n+1}=j | X_n=i)$$

**$n$ 步转移概率**：从状态 $i$ 经过 $n$ 步转移到状态 $j$ 的概率：

$$p_{ij}^{(n)} = P(X_{m+n}=j | X_m=i)$$

特别地，$p_{ij}^{(0)} = \delta_{ij} = \begin{cases} 1, & i=j \\ 0, & i \neq j \end{cases}$

### 1.3 转移概率矩阵

**定义3（一步转移概率矩阵）**：矩阵 $\mathbf{P} = (p_{ij})$ 称为马尔可夫链的**一步转移概率矩阵**，其中：

$$\mathbf{P} = \begin{pmatrix}
p_{00} & p_{01} & p_{02} & \cdots \\
p_{10} & p_{11} & p_{12} & \cdots \\
p_{20} & p_{21} & p_{22} & \cdots \\
\vdots & \vdots & \vdots & \ddots
\end{pmatrix}$$

**定义4（$n$ 步转移概率矩阵）**：矩阵 $\mathbf{P}^{(n)} = (p_{ij}^{(n)})$ 称为 **$n$ 步转移概率矩阵**。

## 2. 核心性质

### 2.1 转移概率矩阵的基本性质

**性质1（非负性）**：
$$p_{ij} \geq 0, \quad \forall i, j \in S$$

**性质2（归一性）**：对任意 $i \in S$，有
$$\sum_{j \in S} p_{ij} = 1$$

满足上述两条性质的矩阵称为**随机矩阵**。

### 2.2 Chapman-Kolmogorov方程

**定理1（C-K方程）**：对任意 $n, m \geq 0$ 和 $i, j \in S$，有：

$$p_{ij}^{(n+m)} = \sum_{k \in S} p_{ik}^{(n)} p_{kj}^{(m)}$$

**矩阵形式**：
$$\mathbf{P}^{(n+m)} = \mathbf{P}^{(n)} \cdot \mathbf{P}^{(m)}$$

**推论**：
$$\mathbf{P}^{(n)} = \mathbf{P}^n = \underbrace{\mathbf{P} \cdot \mathbf{P} \cdots \mathbf{P}}_{n \text{个}}$$

### 2.3 初始分布与绝对概率

**定义5（初始分布）**：$\boldsymbol{\pi}^{(0)} = (\pi_i^{(0)})$，其中：
$$\pi_i^{(0)} = P(X_0 = i), \quad \sum_{i \in S} \pi_i^{(0)} = 1$$

**定理2（绝对概率公式）**：$n$ 时刻的状态分布为：
$$\pi_j^{(n)} = P(X_n = j) = \sum_{i \in S} \pi_i^{(0)} p_{ij}^{(n)}$$

**矩阵形式**：
$$\boldsymbol{\pi}^{(n)} = \boldsymbol{\pi}^{(0)} \mathbf{P}^n$$

## 3. 关键公式

### 3.1 概率计算公式

**轨道概率**：
$$P(X_0=i_0, X_1=i_1, \ldots, X_n=i_n) = \pi_{i_0}^{(0)} p_{i_0i_1} p_{i_1i_2} \cdots p_{i_{n-1}i_n}$$

**全概率公式**：
$$P(X_n = j) = \sum_{i \in S} P(X_0 = i) P(X_n = j | X_0 = i) = \sum_{i \in S} \pi_i^{(0)} p_{ij}^{(n)}$$

### 3.2 首达时间与首达概率

**首达时间**：
$$T_j = \min\{n \geq 1: X_n = j\}$$

**首达概率**：
$$f_{ij}^{(n)} = P(T_j = n | X_0 = i) = P(X_n=j, X_k \neq j, k=1,\ldots,n-1 | X_0=i)$$

**最终首达概率**：
$$f_{ij} = P(T_j < \infty | X_0 = i) = \sum_{n=1}^{\infty} f_{ij}^{(n)}$$

**关系式**：
$$p_{ij}^{(n)} = \sum_{k=1}^{n} f_{ij}^{(k)} p_{jj}^{(n-k)}$$

### 3.3 平均首达时间

**定义**：
$$\mu_{ij} = E[T_j | X_0 = i] = \sum_{n=1}^{\infty} n f_{ij}^{(n)}$$

**平均返回时间**：
$$\mu_{ii} = E[T_i | X_0 = i]$$

## 4. 典型例子

### 例1：两状态马尔可夫链

考虑天气模型，状态空间 $S = \{0, 1\}$，其中 $0$ 表示晴天，$1$ 表示雨天。

**转移概率矩阵**：
$$\mathbf{P} = \begin{pmatrix}
0.7 & 0.3 \\
0.4 & 0.6
\end{pmatrix}$$

即：$p_{00} = 0.7$（晴天后仍是晴天），$p_{01} = 0.3$（晴天后转雨天），$p_{10} = 0.4$（雨天后转晴天），$p_{11} = 0.6$（雨天后仍是雨天）。

**计算两步转移概率矩阵**：
$$\mathbf{P}^{(2)} = \mathbf{P}^2 = \begin{pmatrix}
0.7 & 0.3 \\
0.4 & 0.6
\end{pmatrix} \begin{pmatrix}
0.7 & 0.3 \\
0.4 & 0.6
\end{pmatrix}$$

$$= \begin{pmatrix}
0.7 \times 0.7 + 0.3 \times 0.4 & 0.7 \times 0.3 + 0.3 \times 0.6 \\
0.4 \times 0.7 + 0.6 \times 0.4 & 0.4 \times 0.3 + 0.6 \times 0.6
\end{pmatrix}$$

$$= \begin{pmatrix}
0.61 & 0.39 \\
0.52 & 0.48
\end{pmatrix}$$

**初始分布计算**：若初始分布为 $\boldsymbol{\pi}^{(0)} = (0.6, 0.4)$，则两天后的分布为：

$$\boldsymbol{\pi}^{(2)} = \boldsymbol{\pi}^{(0)} \mathbf{P}^2 = (0.6, 0.4) \begin{pmatrix}
0.61 & 0.39 \\
0.52 & 0.48
\end{pmatrix}$$

$$= (0.6 \times 0.61 + 0.4 \times 0.52, \quad 0.6 \times 0.39 + 0.4 \times 0.48)$$

$$= (0.574, 0.426)$$

### 例2：随机游走

考虑简单随机游走，状态空间 $S = \{0, 1, 2, 3, 4\}$，在状态 $i$ $(1 \leq i \leq 3)$ 时，以概率 $p=0.5$ 向右移动一步，以概率 $q=0.5$ 向左移动一步。状态 $0$ 和 $4$ 是吸收态。

**转移概率矩阵**：
$$\mathbf{P} = \begin{pmatrix}
1 & 0 & 0 & 0 & 0 \\
0.5 & 0 & 0.5 & 0 & 0 \\
0 & 0.5 & 0 & 0.5 & 0 \\
0 & 0 & 0.5 & 0 & 0.5 \\
0 & 0 & 0 & 0 & 1
\end{pmatrix}$$

**计算**：从状态 $2$ 出发，两步后到达状态 $2$ 的概率：

$$p_{22}^{(2)} = p_{21}p_{12} + p_{22}p_{22} + p_{23}p_{32}$$
$$= 0.5 \times 0.5 + 0 \times 0 + 0.5 \times 0.5 = 0.5$$

### 例3：Ehrenfest模型

两个容器，共有 $N=4$ 个球。每次随机选一个球，将其移到另一容器。设 $X_n$ 为第一个容器中的球数。

**转移概率**：
$$p_{ij} = \begin{cases}
\frac{i}{N}, & j = i-1 \\
\frac{N-i}{N}, & j = i+1 \\
0, & \text{其他}
\end{cases}$$

对于 $N=4$：
$$\mathbf{P} = \begin{pmatrix}
0 & 1 & 0 & 0 & 0 \\
0.25 & 0 & 0.75 & 0 & 0 \\
0 & 0.5 & 0 & 0.5 & 0 \\
0 & 0 & 0.75 & 0 & 0.25 \\
0 & 0 & 0 & 1 & 0
\end{pmatrix}$$

## 5. 与其他概念的联系

### 5.1 与独立随机变量序列的关系

- **独立序列**：$P(X_{n+1}=j | X_n=i, \ldots, X_0=i_0) = P(X_{n+1}=j)$
- **马尔可夫链**：$P(X_{n+1}=j | X_n=i, \ldots, X_0=i_0) = P(X_{n+1}=j | X_n=i)$

独立随机变量序列是特殊的马尔可夫链，其转移概率与当前状态无关：$p_{ij} = \pi_j$。

### 5.2 与随机游走的关系

**简单随机游走**是特殊的马尔可夫链：
- 状态空间：$S = \mathbb{Z}$ 或有限子集
- 转移概率：$p_{i,i+1} = p$，$p_{i,i-1} = q = 1-p$

**对称随机游走**：$p = q = 0.5$

### 5.3 与生灭过程的关系

**生灭过程**是特殊的马尔可夫链，只能在相邻状态间转移：
$$p_{ij} = 0, \quad |i-j| > 1$$

转移概率：
- $p_i$：出生率（$i \to i+1$）
- $q_i$：死亡率（$i \to i-1$）
- $r_i = 1-p_i-q_i$：停留概率

### 5.4 与泊松过程的关系

**连续时间马尔可夫链**是马尔可夫链的推广：
- 时间参数连续：$t \in [0, \infty)$
- 泊松过程是最简单的连续时间马尔可夫链

**转移速率矩阵** $\mathbf{Q} = (q_{ij})$：
$$P_t = e^{t\mathbf{Q}} = \sum_{n=0}^{\infty} \frac{t^n \mathbf{Q}^n}{n!}$$

### 5.5 与平稳分布的关系

**平稳分布** $\boldsymbol{\pi} = (\pi_j)$ 满足：
$$\boldsymbol{\pi} = \boldsymbol{\pi} \mathbf{P}$$

即：
$$\pi_j = \sum_{i \in S} \pi_i p_{ij}, \quad \sum_{j \in S} \pi_j = 1$$

**细致平衡条件**（可逆性）：
$$\pi_i p_{ij} = \pi_j p_{ji}, \quad \forall i, j \in S$$

## 6. 常见考点与易错点

### 6.1 学习要点

**重点1：马尔可夫性的理解**
- 核心：未来只依赖于现在，与过去无关
- 数学表达：条件概率的简化
- 应用：判断一个过程是否为马尔可夫链

**重点2：转移概率矩阵的性质**
- 每行元素非负且和为1
- 矩阵乘法对应多步转移
- $\mathbf{P}^n$ 的计算方法

**重点3：Chapman-Kolmogorov方程**
- 理解：多步转移的分解
- 应用：计算 $n$ 步转移概率
- 矩阵形式的运用

**重点4：状态分类**
- 常返态与暂态
- 周期性
- 遍历性

### 6.2 常见错误

**错误1：混淆条件概率的条件**

❌ 错误：$P(X_n=j | X_0=i) = p_{ij}$

✓ 正确：$P(X_n=j | X_0=i) = p_{ij}^{(n)}$，$P(X_1=j | X_0=i) = p_{ij}$

**错误2：转移概率矩阵的乘法顺序**

对于行向量表示的分布：
$$\boldsymbol{\pi}^{(n)} = \boldsymbol{\pi}^{(0)} \mathbf{P}^n \quad \text{（正确）}$$

不是 $\mathbf{P}^n \boldsymbol{\pi}^{(0)}$（除非用列向量）

**错误3：忽略初始分布**

计算 $P(X_n=j)$ 时必须考虑初始分布：
$$P(X_n=j) = \sum_{i} P(X_0=i) p_{ij}^{(n)}$$

**错误4：混淆首达概率和转移概率**

- $f_{ij}^{(n)}$：首次到达（中间不经过 $j$）
- $p_{ij}^{(n)}$：$n$ 步后到达（可能中间经过 $j$）

关系：$p_{ij}^{(n)} = \sum_{k=1}^{n} f_{ij}^{(k)} p_{jj}^{(n-k)}$

### 6.3 解题技巧

**技巧1：矩阵快速幂**

计算 $\mathbf{P}^n$ 时：
- 对角化：$\mathbf{P} = \mathbf{Q} \mathbf{\Lambda} \mathbf{Q}^{-1}$，则 $\mathbf{P}^n = \mathbf{Q} \mathbf{\Lambda}^n \mathbf{Q}^{-1}$
- 特征值方法：找特征值和特征向量

**技巧2：利用对称性**

若转移概率矩阵有对称性，可简化计算。

**技巧3：递推关系**

利用 C-K 方程建立递推关系：
$$p_{ij}^{(n+1)} = \sum_{k} p_{ik}^{(n)} p_{kj}$$

**技巧4：状态分类简化**

- 识别吸收态：$p_{ii}=1$
- 识别瞬态：$f_{ii}<1$
- 利用状态分解简化矩阵

**技巧5：验证答案**

- 检查概率和是否为1
- 检查非负性
- 用简单情况验证（如 $n=1,2$）

### 6.4 典型题型

**题型1：判断马尔可夫性**

给定随机过程，判断是否满足马尔可夫性。

**题型2：构造转移概率矩阵**

根据实际问题描述，写出转移概率矩阵。

**题型3：计算多步转移概率**

给定 $\mathbf{P}$，计算 $\mathbf{P}^n$ 或特定的 $p_{ij}^{(n)}$。

**题型4：求平稳分布**

解方程组 $\boldsymbol{\pi} = \boldsymbol{\pi} \mathbf{P}$，$\sum_i \pi_i = 1$。

**题型5：首达问题**

计算首达概率和平均首达时间。

---

**总结**：马尔可夫链是随机过程中最基础且应用最广泛的模型。掌握其定义、转移概率矩阵的性质和计算方法是学习后续内容（状态分类、极限定理、平稳分布等）的基础。
