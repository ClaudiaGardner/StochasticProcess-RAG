# 例题3.31

## 题目

在二进制序列中找一个字符串： 假设{Xi : i ⩾0} 是一个伯努利过程，其满足 Pr{Xi = 1} = p1，Pr{Xi = 0} = p0 = 1 −p1。 一个二进制串a = (a1，. . . ，ak) 在时间n 发生的条件是 (Xn−k+1，. . . ，Xn) = (a1，. . . ，ak)。 我们想要找到第一次出现该字符串时的期望时间n。 • 假如该字符串是一个单独的二进制数字，例如1。 那么它在时间n 发生的概率为pn−1 0 p1。期望值可以表示为 ∞ X n=1 npn−1 0 p1 = 1 p1 。 可以把这个问题表述为一个期望首次通过时间的问题，如图得到v0 = 1 + p0v0，即v0 = 1 p1 。 • 假设字符串为a = (1, 0)。 方法一：在之前的情况下，首个出现1 的预期时间为1/p1。然后会有一个零或多个连续的1 的延迟，直到 下一个0 出现。此时，字符串(1, 0) 刚刚出现，额外的预期延迟为1/p0。因此，总体延迟为 1 p1 + 1 p0 = 1 p0p1 。 方法二：假设Zn = (Xn−1, Xn)，初始化Z0 = (0, 0)。期望首次通过时间 方法三：构建一个具有k + 1 个状态的马尔可夫链。我们定义在时间n 时马尔可夫链处于状态i < k，如 果(a1，. . . ，ak) 尚未出现，并且(Xn−i+1，. . . ，Xn) 是X1，. . . ，Xn 形成(a1，. . . ，ak) 的最长后缀 的前缀。得到 ( v0 = 1 + p0v0 + p1v1 v1 = 1 + p1v1 即v0 = 1 p0p1 。 40 3.6. 课后习题 • 假设更一般的字符串a = (1，0，1，0，0)。 例如，状态4 表示如果下一个比特是0，字符串10100 将出现。如果下一个比特是1，则最近的五个比特 将是10101，其中最后三个是10100 的前三个比特，导致进入状态3。

## 解答

## 解题

### 题目分析

本题研究在伯努利过程中寻找特定二进制字符串的期望首次出现时间。给定伯努利过程 $\{X_i : i \geq 0\}$，其中 $\text{Pr}\{X_i = 1\} = p_1$，$\text{Pr}\{X_i = 0\} = p_0 = 1 - p_1$。核心是利用马尔可夫链和首次通过时间理论，通过构建状态空间来追踪字符串匹配的进度。题目展示了三种不同复杂度的字符串：单个数字、两位字符串 $(1,0)$ 和更复杂的字符串 $(1,0,1,0,0)$，分别用不同方法求解期望首次出现时间。

### 解题过程

**情况1：单个数字字符串 $a = (1)$**

字符串在时间 $n$ 首次出现意味着前 $n-1$ 个都是0，第 $n$ 个是1。

概率为 $p_0^{n-1} p_1$，期望时间为：
$$E[T] = \sum_{n=1}^{\infty} n p_0^{n-1} p_1 = p_1 \sum_{n=1}^{\infty} n p_0^{n-1} = p_1 \cdot \frac{1}{(1-p_0)^2} = p_1 \cdot \frac{1}{p_1^2} = \frac{1}{p_1}$$

用马尔可夫链方法：设状态0为未匹配，状态1为已匹配。设 $v_0$ 为从状态0到状态1的期望时间：
$$v_0 = 1 + p_0 v_0 + p_1 \cdot 0$$

解得：$v_0(1-p_0) = 1$，即 $v_0 = \frac{1}{p_1}$

**情况2：字符串 $a = (1,0)$**

**方法一（直接分解）：**
首先等待第一个1出现，期望时间为 $\frac{1}{p_1}$。然后可能出现连续的1（每次延迟1个时间单位），直到出现0。从出现1后到出现0的期望时间为 $\frac{1}{p_0}$。总期望时间：
$$E[T] = \frac{1}{p_1} + \frac{1}{p_0} = \frac{1}{p_0 p_1}$$

**方法二（二维马尔可夫链）：**
定义 $Z_n = (X_{n-1}, X_n)$，初始 $Z_0 = (0,0)$。构建状态空间追踪最近两位。

**方法三（标准马尔可夫链）：**
定义状态：
- 状态0：未匹配任何前缀
- 状态1：最后一位是1（匹配了 $a_1$）
- 状态2：匹配完成（吸收态）

转移方程：
$$v_0 = 1 + p_0 v_0 + p_1 v_1$$
$$v_1 = 1 + p_1 v_1 + p_0 \cdot 0$$

从第二个方程：$v_1(1-p_1) = 1$，得 $v_1 = \frac{1}{p_0}$

代入第一个方程：$v_0(1-p_0) = 1 + p_1 v_1 = 1 + \frac{p_1}{p_0}$

$$v_0 = \frac{1}{p_1}\left(1 + \frac{p_1}{p_0}\right) = \frac{1}{p_1} + \frac{1}{p_0} = \frac{1}{p_0 p_1}$$

**情况3：字符串 $a = (1,0,1,0,0)$**

构建5+1=6个状态的马尔可夫链：
- 状态 $i$ ($i=0,1,2,3,4$)：已匹配字符串的前 $i$ 位
- 状态5：完全匹配（吸收态）

关键是确定转移：从状态 $i$ 读入新比特后，若不能进入状态 $i+1$，需找到当前后缀与字符串前缀的最长匹配。

例如从状态4（已匹配1010），若读入1，则最近5位为10101，其最长匹配前缀是101（状态3）。

转移方程组：
$$v_0 = 1 + p_0 v_0 + p_1 v_1$$
$$v_1 = 1 + p_1 v_1 + p_0 v_2$$
$$v_2 = 1 + p_0 v_0 + p_1 v_3$$
$$v_3 = 1 + p_1 v_3 + p_0 v_4$$
$$v_4 = 1 + p_1 v_3 + p_0 \cdot 0$$

从后向前求解此线性方程组可得 $v_0$。

### 答案

- 字符串 $(1)$：期望首次出现时间为 $\boxed{\frac{1}{p_1}}$

- 字符串 $(1,0)$：期望首次出现时间为 $\boxed{\frac{1}{p_0 p_1}}$

- 字符串 $(1,0,1,0,0)$：需求解上述线性方程组得到 $v_0$

### 知识延伸

**核心定理与性质：**
1. **首次通过时间理论**：对于马尔可夫链，从状态 $i$ 到状态 $j$ 的期望首次通过时间满足线性方程组
2. **字符串匹配的KMP思想**：状态转移需要找最长公共前后缀，类似KMP算法的失配函数
3. **伯努利过程的无记忆性**：简化了状态定义

**重要公式：**
- 几何分布期望：$E[T] = \frac{1}{p}$
- 首次通过时间方程：$v_i = 1 + \sum_j p_{ij} v_j$（$v_j = 0$ 若 $j$ 是目标状态）

**解题技巧：**
1. 正确识别状态空间：状态数为字符串长度+1
2. 仔细分析失配转移：需要字符串自身的结构分析
3. 建立线性方程组并从后向前求解

**易错点：**
1. 忽略失配后的状态转移（如状态4读入1应转到状态3而非状态0）
2. 混淆"在时间n出现"与"首次出现时间"的概率计算
3. 线性方程组求解时的代数错误

---
