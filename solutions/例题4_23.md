# 例题4.23

## 题目

考虑一个抛硬币的情景，正面出现的概率为p。每次抛掷结果正面赢得$1，反面输掉$1。当 赢钱达到 $1 时停止。我们可以将其建模为一系列独立同分布的随机变量 X1，X2，. . . ，其中每个 Xi 以概率 p 取值为1，以概率1 − p 取值为−1。考虑可能缺陷的停止时间J 是第一个使得Sn = X1 + · · · + Xn = 1 的n，即 赌徒首次取得盈利的试验。 令θ = Pr{J < ∞}. 则θ = p + (1 − p)θ2，解得 θ = 1 或者 θ = p/(1 − p)。 • 考虑 p > 1/2，对应的解是 θ = 1 , 因为后者不是概率。从另外角度，在没有停止的情况下，你的赢钱会无 限增长，经过$1，因此J 必须是一个随机变量。SJ = 1 WP1，所以E[SJ ] = 1 。 因此，我们有 E[J] = 1 X = 1 2p − 1。 从另一角度来说，注意到J = 1 的概率为p。如果J > 1，即S1 = −1，那么达到Sn = 1 的唯一方法是从 S1 = −1 到达某个Sm = 0 （平均需要 J 步） ；然后再平均需要J 步到达 1。因此， J = p + (1 − p)(1 + 2 J), 这意味着J = 1 2p−1 . • 考虑 p < 1/2，θ = p/(1 − p) 是正确的解, θ = 1 不是。因此，θ = Pr{J < ∞} ̸= 1 ，瓦尔德等式不适用于 这种情况。 • 考虑p = 1/2 ，当p 从下方接近1/2 时，Pr{J < ∞} = p/(1 − p) → 1。然而，当p 从上方接近1/2 时，我 们可以看到 E[J] = 1/(2 p − 1) → ∞。 瓦尔德等式在这里不成立，因为 E[J] = ∞，实际上因为X = 0 ，也没有意义。 领先的概率是1，但有两个问题：一，平均时间是无穷；二、潜在资本风险。 4.4.2 广义停止试验 【定义4.24】 对于一系列随机变量(X1，Y1)，(X2，Y2)，. . . 的配对的广义停止试验J 是一个取正整数值 的随机变量，对于每个 n ⩾ 1，IJ=n 是由 X1、Y1 X2、Y2，· · ·，Xn、Yn 确定的函数。 由此可知，IJ<n = 1 − IJ⩾n 是由 X1、Y1, · · · , Xn−1、Yn−1 确定的函数。 【定理4.25】 (广义瓦尔德等式) 假设{(Xn，(Yn)；(n ⩾ 1} 是一系列随机变量对， 其中每对随机变量与其他 随机变量独立同分布。假设每个Xi 的均值有限且为X。如果J 是{(Xn，Yn)；n ⩾ 1} 的停时，并且E[J] < ∞， 那么和SJ = X1 + X2 + · · · + XJ 满足以下公式： E[SJ ] = XE[J]。 注：同时，每个 Yi 也可以被替换为一组随机变量序列的向量。 4.4.3 G/G/1 队列 • 到达间隔时间是独立同分布的。让{Xi; i ⩾ 1} 表示独立同分布的到达间隔时间序列，其中Xi 是顾客i − 1 到达和顾客i 到达之间的时间间隔。 • 服务时间是独立同分布的，并且与到达间隔时间相互独立。让{Vi; i ⩾ 0} 表示这些顾客所需的独立同分布 的服务时间；这些服务时间与到达间隔时间相互独立。 • 顾客0 在时间 0 到达并立即进入服务器。如果服务器忙碌，后续到达的顾客将排队等待。 53 4.4. 重复实验的停止时间 • 当服务器完成前一个服务时，每个排队等待的到达顺序按照先到先服务（FCFS）的原则进入服务器。 • 对于顾客1，如果X1 < V0，则第一位到达的顾客需要在队列中等待Wq 1 = V0 − X1。否则，顾客1 将立即 进入服务。因此， Wq 1 = max{V0 − X1，0}。 • 对于顾客i，其在系统中的时间为排队等待时间和服务时间之和，即： Wq i = max{Wq i−1 + Vi−1 − Xi，0}。 考虑开始一个新的繁忙期的第一次到达（s3 上面）为广义停止试验。 • 成对随机变量的序列为 (X1, V0)，(X2, V1)，. . . 。 • J 是满足Pn i=1 Xi − Pn−1 i=0 Vi−1 ⩾ 0 的最小 n。 • 如果E[X] > E[V ]，那么limn→∞ Pr{Pn i=1 Xi − Pn−1 i=0 Vi−1) ⩾ 0} = 1 。因此，J 是一个广义的停时。 • 如果E[J] < ∞，则广义Wald 等式成立且 E[SJ ] < ∞。 新的繁忙期之间的时间间隔构成一个更新过程。 在给定J = j 的条件下，对于k ⩾ 1，令X2,k = Xj+k，V2,k−1 = Vj+k−1，则{(X2,k, V2,k−1); k ⩾ 1} 是一组 具有原始分布的独立同分布的随机变量对，

## 解答

**Focusing on Structure and Refinement**

I've been meticulously refining the solution's structure. The analysis, solution, answer, and extension sections are taking shape, ensuring a clear and logical flow. LaTeX formatting is being double-checked, and the tone is appropriately professional. I'm focusing on clarifying the notation regarding $E[J]$ versus the random variable $J$, ensuring the presentation is mathematically sound.


### 题目分析

本题考查**简单随机游走（Simple Random Walk）**中的**首达时间（First Passage Time）**问题，以及**瓦尔德恒等式（Wald's Identity）**的应用条件。

具体模型为：
1.  **随机变量**：$X_1, X_2, \dots$ 独立同分布（i.i.d.），$P(X_i=1)=p$，$P(X_i=-1)=1-p$。
2.  **累计和**：$S_n = \sum_{i=1}^n X_i$，表示赌徒的累计盈亏。
3.  **停止时间**：$J = \min\{n : S_n = 1\}$，即首次达到盈利 $1$ 的时刻。
4.  **核心目标**：
    *   计算停时有限的概率 $\theta = P(J < \infty)$。
    *   在 $p > 1/2$ 时，计算平均停止时间 $E[J]$。
    *   分析 $p \le 1/2$ 时的情况，特别是瓦尔德恒等式为何失效。

---

### 解题过程

#### 1. 建立概率模型与方程

设 $X_i$ 为第 $i$ 次抛掷的结果：
$$
X_i = \begin{cases} 1, & \text{概率 } p \\ -1, & \text{概率 } 1-p \end{cases}
$$
单步期望为 $E[X_i] = 1 \cdot p + (-1) \cdot (1-p) = 2p - 1$。
停止时间定义为 $J = \min\{n \ge 1 : S_n = 1\}$。

#### 2. 计算停止概率 $\theta = P(J < \infty)$

利用**全概率公式（First Step Analysis）**分析。考虑第一次试验的结果 $X_1$：
*   若 $X_1 = 1$，则 $S_1 = 1$，过程立即停止，概率为 $p$。
*   若 $X_1 = -1$，则 $S_1 = -1$。为了使 $S_n$ 最终到达 $1$，过程必须先从 $-1$ 回到 $0$（概率同为 $\theta$），然后再从 $0$ 到达 $1$（概率为 $\theta$）。由于随机游走的空间齐次性和独立增量性，这两步发生的概率积为 $\theta^2$。

因此，$\theta$ 满足方程：
$$
\theta = p \cdot 1 + (1-p) \cdot \theta^2
$$
整理得一元二次方程：
$$
(1-p)\theta^2 - \theta + p = 0
$$
解该方程：
$$
(1-p)\theta^2 - (1-p)\theta - p\theta + p = 0 \\
(1-p)\theta(\theta - 1) - p(\theta - 1) = 0 \\
((1-p)\theta - p)(\theta - 1) = 0
$$
解得两个根：$\theta_1 = 1$ 和 $\theta_2 = \frac{p}{1-p}$。

根据随机游走的性质（Drift），我们需要讨论 $p$ 的取值：

*   **情形 1：$p > 1/2$**
    此时 $\frac{p}{1-p} > 1$。由于概率 $\theta \le 1$，故唯一合理的解是：
    $$
    \theta = 1
    $$
    这意味着当赢面大于输面时，赌徒**必然**会盈利。

*   **情形 2：$p < 1/2$**
    此时 $\frac{p}{1-p} < 1$。根据随机游走的瞬态性（Transience），过程以正概率趋向于 $-\infty$，因此不会必然到达 $1$。正确的解是较小的那个正根：
    $$
    \theta = \frac{p}{1-p}
    $$

*   **情形 3：$p = 1/2$**
    此时 $\frac{p}{1-p} = 1$，方程有重根，$\theta = 1$。这是一维对称随机游走的常返性（Recurrence）。

#### 3. 计算期望停止时间 $E[J]$

我们重点讨论 $p > 1/2$ 的情况，此时 $P(J < \infty) = 1$，即 $J$ 是一个正常的随机变量。

**方法一：利用瓦尔德恒等式 (Wald's Equation)**

瓦尔德恒等式成立的条件是 $E[J] < \infty$ 且 $X_i$ 均值有限。假设 $E[J] < \infty$（对于 $p > 1/2$ 成立），则有：
$$
E[S_J] = E[J] \cdot E[X_1]
$$
根据定义，停止时 $S_J = 1$，所以 $E[S_J] = 1$。
代入 $E[X_1] = 2p - 1$：
$$
1 = E[J] \cdot (2p - 1)
$$
解得：
$$
E[J] = \frac{1}{2p - 1}
$$

**方法二：条件期望法 (First Step Analysis)**

设 $x = E[J]$。基于第一次抛掷结果进行分解：
*   以概率 $p$，第一步即成功，$X_1=1$，耗时 $1$ 步。
*   以概率 $1-p$，第一步失败，$X_1=-1$。此时状态为 $-1$。要到达 $1$，需先花费平均 $x$ 步回到 $0$，再花费平均 $x$ 步从 $0$ 到 $1$。总耗时为 $1 + x + x = 1 + 2x$。

建立方程：
$$
x = p(1) + (1-p)(1 + 2x)
$$
化简：
$$
x = p + 1 - p + 2(1-p)x \\
x = 1 + 2(1-p)x \\
x [1 - 2(1-p)] = 1 \\
x [1 - 2 + 2p] = 1 \\
x (2p - 1) = 1
$$
同样解得：
$$
E[J] = \frac{1}{2p - 1}
$$

#### 4. 分析 $p \le 1/2$ 时瓦尔德恒等式的失效

*   **当 $p < 1/2$ 时**：
    虽然 $E[X_1] < 0$，但由于 $\theta = \frac{p}{1-p} < 1$，即 $P(J = \infty) > 0$。$J$ 是一个**缺陷随机变量（Defective Random Variable）**，其期望 $E[J]$ 无定义或可视作无穷大。瓦尔德恒等式前提条件 $P(J<\infty)=1$ 不满足，故不适用。

*   **当 $p = 1/2$ 时**：
    此时 $E[X_1] = 0$。虽然 $P(J < \infty) = 1$，但期望时间 $E[J] = \infty$。
    若强行套用瓦尔德恒等式 $E[S_J] = E[J]E[X]$，会得到 $1 = \infty \cdot 0$，这是无意义的。
    从极限角度看，当 $p \to 1/2^+$ 时：
    $$
    \lim_{p \to 1/2^+} E[J] = \lim_{p \to 1/2^+} \frac{1}{2p - 1} = +\infty
    $$

---

### 答案

1.  **停止概率** $\theta = P(J < \infty)$ 为：
    $$
    \theta = \begin{cases} 1, & p \ge 1/2 \\ \frac{p}{1-p}, & p < 1/2 \end{cases}
    $$

2.  **期望停止时间** $E[J]$ 为：
    $$
    E[J] = \begin{cases} \frac{1}{2p - 1}, & p > 1/2 \\ \infty, & p \le 1/2 \end{cases}
    $$

---

### 知识延伸

1.  **瓦尔德恒等式 (Wald's Identity)**：
    $$
    E[S_J] = E[J] \cdot E[X]
    $$
    **成立的关键条件**：
    *   $X_n$ 独立同分布且 $E[|X|] < \infty$。
    *   $J$ 是关于 $\{X_n\}$ 的停时。
    *   $E[J] < \infty$。
    *   在本题 $p=1/2$ 的情况下，虽然 $J$ 几乎处处有限，但 $E[J]=\infty$，导致恒等式失效。

2.  **赌徒破产问题 (Gambler's Ruin)**：
    本题是赌徒破产问题的变体（单边边界）。如果存在两个边界（例如 $-A$ 和 $B$），则 $E[J]$ 总是有限的，瓦尔德恒等式总是成立。本题相当于将负边界设为 $-\infty$。

3.  **广义停时与 G/G/1 队列**：
    题目后半部分提到的广义停时（Generalized Stopping Time）将概念扩展到了成对序列 $(X_n, Y_n)$。在 G/G/1 队列中，繁忙期（Busy Period）的结束可以看作是一个随机游走首次回到或穿越 0 的时刻。若服务率 $\mu$ 大于到达率 $\lambda$（即 $E[X] > E[V]$，对应本题 $p < 1/2$ 的反向情况），则繁忙期必然结束且期望长度有限。

---
