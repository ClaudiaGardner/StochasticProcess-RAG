# 习题3.11

## 题目

某人有 $M$ 把伞并在办公室和家之间往返：出门上班时下雨并家里有伞就带把伞去办公室；下班回家时下雨且办公室有伞就带把伞回家，其它时候都不带伞。假设每天上下班时是否下雨是独立同分布的，下雨的概率为 $p$ ，不下雨的概率为 $1-p$ ，问此人出门上班时碰到下雨且没有雨伞的概率。

## 解答

**Problem Refinement**

The model is now solidified; the state space and transitions are confirmed to be accurate. The stationary distribution has been derived and verified for the general case, and a specific check for M=1 was performed. Analysis, solution, answer, and knowledge extension will now be written.


### 题目分析

本题考查**离散时间马尔可夫链（Discrete-time Markov Chain, DTMC）** 的建立与平稳分布的求解。

*   **符号识别**：$M$ 为雨伞总数，$p$ 为下雨概率，$1-p$ 为不下雨概率（通常记为 $q$）。
*   **核心概念**：通过定义状态（当前地点的雨伞数量），构建状态转移矩阵，利用马尔可夫链的遍历性求出平稳分布（Stationary Distribution）。
*   **求解目标**：计算“出门上班时碰到下雨且没有雨伞”的概率，即求出长远来看当前地点没有雨伞的平稳概率 $\pi_0$，再乘以发生下雨的概率 $p$。

### 解题过程

**1. 建立马尔可夫链模型**

设 $X_n$ 表示第 $n$ 次行程开始前，**当前出发地点**（家或办公室）拥有的雨伞数量。
状态空间为 $S = \{0, 1, 2, \dots, M\}$。

**2. 分析状态转移概率**

记 $q = 1-p$ 为不下雨的概率。
假设当前地点有 $i$ 把伞，则目的地有 $M-i$ 把伞。
我们分析从当前状态 $i$ 转移到下一次行程出发时的状态 $j$（即到达目的地后的雨伞数量）：

*   **情形 1：当前没有伞 ($i=0$)**
    无论是否下雨，都无法带伞。
    到达目的地后，目的地原有的伞数为 $M-0 = M$。
    因此，下一次出发时的状态必然是 $M$。
    $$P_{0, M} = 1$$

*   **情形 2：当前有伞 ($i \in \{1, 2, \dots, M\}$)**
    *   **如果下雨（概率 $p$）**：带走 1 把伞。
        到达目的地时，目的地原有的伞数为 $M-i$，加上带来的 1 把，共 $M-i+1$ 把。
        即转移到状态 $M-i+1$。
    *   **如果不下雨（概率 $q$）**：不带伞。
        到达目的地时，目的地原有的伞数为 $M-i$。
        即转移到状态 $M-i$。

综上，转移概率 $P_{ij}$ 为：
$$
\begin{cases}
P_{0, M} = 1 \\
P_{i, M-i+1} = p, & i \neq 0 \\
P_{i, M-i} = q, & i \neq 0
\end{cases}
$$

**3. 建立平稳分布方程**

设平稳分布为 $\pi = (\pi_0, \pi_1, \dots, \pi_M)$。根据平稳方程 $\pi_j = \sum_{i} \pi_i P_{ij}$ 列出方程组：

*   **对于状态 $0$**：
    只有当 $i=M$ 且不下雨（转移到 $M-M=0$）时才会进入状态 0。
    $$\pi_0 = \pi_M \cdot q \quad \cdots\cdots (1)$$

*   **对于状态 $M$**：
    当 $i=0$（必然转移到 $M$）或 $i=1$ 且下雨（转移到 $M-1+1=M$）时进入状态 $M$。
    $$\pi_M = \pi_0 \cdot 1 + \pi_1 \cdot p \quad \cdots\cdots (2)$$

*   **对于中间状态 $k$ ($1 \le k < M$)**：
    进入状态 $k$ 有两种可能：
    1. 从状态 $i$ 不下雨转移而来：$M-i = k \Rightarrow i = M-k$。
    2. 从状态 $i$ 下雨转移而来：$M-i+1 = k \Rightarrow i = M-k+1$。
    $$\pi_k = \pi_{M-k} \cdot q + \pi_{M-k+1} \cdot p \quad \cdots\cdots (3)$$

**4. 求解平稳分布**

将 $(1)$ 代入 $(2)$：
$$
\pi_M = q \pi_M + p \pi_1 \implies \pi_M(1-q) = p \pi_1 \implies p \pi_M = p \pi_1
$$
由于 $p > 0$，可得：
$$\pi_1 = \pi_M$$

接下来利用方程 $(3)$ 递推。
当 $k=1$ 时：
$$\pi_1 = \pi_{M-1} \cdot q + \pi_M \cdot p$$
因为 $\pi_1 = \pi_M$，代入得：
$$\pi_M = \pi_{M-1} \cdot q + \pi_M \cdot p \implies \pi_M(1-p) = \pi_{M-1} \cdot q \implies q \pi_M = q \pi_{M-1}$$
由于 $q > 0$，可得：
$$\pi_{M-1} = \pi_M$$

同理，假设 $\pi_{k+1} = \dots = \pi_M$，代入方程 $(3)$ 可归纳得出所有非零状态概率相等：
$$\pi_1 = \pi_2 = \dots = \pi_M$$

设 $\pi_1 = \pi_2 = \dots = \pi_M = C$。
由方程 $(1)$ 可知：
$$\pi_0 = q C$$

利用归一化条件 $\sum_{k=0}^M \pi_k = 1$：
$$
\pi_0 + \sum_{k=1}^M \pi_k = 1 \\
q C + M \cdot C = 1 \\
C(q + M) = 1 \implies C = \frac{1}{M+q}
$$

因此，当前地点没有雨伞的平稳概率为：
$$\pi_0 = \frac{q}{M+q}$$

**5. 计算目标概率**

题目要求“出门上班时碰到下雨且没有雨伞”的概率。
设事件 $A$ 为“下雨”，事件 $B$ 为“当前地点没有雨伞”。
由于下雨与当前雨伞数量独立（雨伞数量取决于之前的过程，当次下雨是独立的随机事件）：
$$P(\text{淋雨}) = P(A \cap B) = P(A) \cdot P(B) = p \cdot \pi_0$$

代入 $\pi_0$ 的值：
$$P(\text{淋雨}) = p \cdot \frac{q}{M+q}$$

将 $q = 1-p$ 代入：
$$P(\text{淋雨}) = \frac{p(1-p)}{M + 1 - p}$$

### 答案

此人出门上班时碰到下雨且没有雨伞的概率为：
$$ \frac{p(1-p)}{M + 1 - p} $$

### 知识延伸

1.  **马尔可夫链的遍历性**：本题中的马尔可夫链是不可约且非周期的（当 $0 < p < 1$ 时），因此存在唯一的平稳分布，且该分布与初始状态无关。
2.  **对称性分析**：由于家和办公室的规则完全对称，$\pi_i$ 既表示在家的雨伞数为 $i$ 的概率，也表示在办公室雨伞数为 $i$ 的概率。
3.  **边界情况检查**：
    *   若 $M$ 很大，$\pi_0 \to 0$，淋雨概率趋近于 0，符合直觉。
    *   若 $p=0$ 或 $p=1$，淋雨概率均为 0。$p=0$ 不下雨自然不淋雨；$p=1$ 每次都带伞，只要 $M \ge 1$，伞会在两地间搬运，永远不会缺伞（注：当 $p=1$ 时链变为周期性，需特殊讨论，但公式极限成立）。
4.  **易错点**：容易混淆“平稳分布 $\pi_0$”与“最终答案”。$\pi_0$ 仅表示没伞的概率，必须乘以“下雨”的概率 $p$ 才是淋雨的概率。

---
