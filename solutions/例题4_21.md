# 例题4.21

## 题目

对于一个伯努利过程{Xn; n ⩾ 1}，模式（1，0）第一次出现时停止。 4.4.1 瓦尔德等式 【定理4.22】 (瓦尔德等式) 设{Xn; n ⩾ 1} 是一组独立同分布的随机变量序列，每个随机变量的均值为X。 如果 J 是{Xn; n ⩾ 1} 的停止时间，并且 E[J] < ∞，那么在停止时间J 时的和SJ = X1 + X2 + · · · + XJ 满足 E[SJ ] = XE[J]。 证明. SJ = JX n=1 Xn = ∞X n=1 XnI{J⩾n}. E[SJ ] = E hX n XnI{J⩾n} i = X n E  XnI{J⩾n}  证明的关键在于证明Xn 和I{J⩾n} 是独立的。注意到 I{J⩾n} = 1 − I{J<n}. 而I{J<n} 是X1, . . . , Xn−1 的函数。由于Xi 是独立同分布的，Xn 与X1, . . . , Xn−1、I{J<n} 以及I{J⩾n} 都是相 互独立的。因此， E[SJ ] = X n E[XnI{J⩾n}] = X n E[Xn]E[I{J⩾n}] =X X n E[I{J⩾n}] =X X n Pr{J ⩾ n} = XE[J]。 52 4.4. 重复实验的停止时间 思考题: 掷一个骰子，点数记为 J。接着再掷 J 次骰子，点数分别记为 X1, X2, · · · , XJ 。若骰子是均匀的， 且各次投掷是独立的，求 E[SJ ]。 思考题: 成功概率 p 的Bernoulli 试验，首次成功平均需要几次试验？能想到多少种解法？

## 解答

**Formulating the Core Solution**

I've finalized the solution for Example 4.21, employing the Markov chain approach for clarity and precision. Also, I have incorporated both the recursive expectation calculation and the martingale method for verification. I will now prepare the LaTeX rendering of the solution, adhering to the required formatting. Furthermore, I will include the answers to the thinking questions in the "Knowledge Extension" segment, as requested in the prompt.


### 题目分析

本题考查**随机过程**中的**伯努利过程（Bernoulli Process）**以及**停止时间（Stopping Time）**的期望计算。

*   **核心对象**：一个伯努利过程 $\{X_n; n \geqslant 1\}$，即一系列独立同分布的随机变量，取值为 0 或 1。
*   **停止条件**：当序列中第一次出现模式 $(1, 0)$ 时停止。
*   **求解目标**：计算停止时间 $J$ 的期望值 $E[J]$。虽然题目文本中包含了瓦尔德等式（Wald's Identity）及其证明，以及两个思考题，但“例题 4.21”的核心任务是针对特定的模式 $(1, 0)$ 求解平均步数。
*   **数学工具**：全期望公式（条件期望）、马尔可夫链状态分析或鞅（Martingale）方法。

---

### 解题过程

设伯努利试验中出现 $1$ 的概率为 $p$，出现 $0$ 的概率为 $q = 1-p$。
我们需要找到模式 $(1, 0)$ 首次出现的平均时间 $E[J]$。

我们可以利用**状态分析法**（基于马尔可夫链的思想）来建立方程求解。

**第一步：定义状态**
根据当前已经匹配的模式进度，我们可以定义以下状态：
*   **状态 $\emptyset$**：初始状态，或者当前序列结尾没有匹配模式的任何前缀（即当前结尾不是 1）。
*   **状态 $1$**：当前序列的结尾是 $1$，已经匹配了模式 $(1, 0)$ 的第一位。
*   **状态 $Target$**：当前序列结尾是 $(1, 0)$，过程停止。

**第二步：设定期望值**
令 $E$ 表示从**初始状态**（或状态 $\emptyset$）到达目标状态所需的平均额外步数。显然 $E[J] = E$。
令 $E_1$ 表示从**状态 $1$** 到达目标状态所需的平均额外步数。

**第三步：建立方程组**
利用全期望公式（Total Probability Theorem for Expectations），分析下一步的转移情况：

1.  **从状态 $\emptyset$ 出发**：
    *   如果掷出 $1$（概率 $p$）：状态转移到 $1$，消耗 1 步，后续还需要 $E_1$ 步。
    *   如果掷出 $0$（概率 $q$）：状态仍为 $\emptyset$（因为 $0$ 不是模式 $(1,0)$ 的起始），消耗 1 步，后续仍需要 $E$ 步。
    
    方程为：
    $$E = p(1 + E_1) + q(1 + E)$$
    
    化简该方程：
    $$E = 1 + pE_1 + qE$$
    由于 $p+q=1$，移项得：
    $$(1-q)E = 1 + pE_1$$
    $$pE = 1 + pE_1 \quad \cdots\cdots \text{(Eq. 1)}$$

2.  **从状态 $1$ 出发**：
    *   如果掷出 $0$（概率 $q$）：完成了模式 $(1, 0)$，过程停止。消耗 1 步，后续需要 0 步。
    *   如果掷出 $1$（概率 $p$）：当前序列变为 $\dots 11$，结尾仍然是 $1$，状态保持在 $1$。消耗 1 步，后续仍需要 $E_1$ 步。
    
    方程为：
    $$E_1 = q(1 + 0) + p(1 + E_1)$$
    
    化简该方程：
    $$E_1 = q + p + pE_1$$
    $$E_1 = 1 + pE_1$$
    移项求解 $E_1$：
    $$E_1(1 - p) = 1$$
    $$E_1 q = 1 \implies E_1 = \frac{1}{q}$$

**第四步：求解 $E$**
将 $E_1 = \frac{1}{q}$ 代入 (Eq. 1)：
$$pE = 1 + p\left(\frac{1}{q}\right)$$
$$pE = 1 + \frac{p}{q} = \frac{q + p}{q} = \frac{1}{q}$$
$$E = \frac{1}{pq}$$

因此，停止时间 $J$ 的期望值为 $\frac{1}{p(1-p)}$。

---

### 答案

对于伯努利过程，模式 $(1, 0)$ 第一次出现的期望停止时间 $E[J]$ 为：
$$E[J] = \frac{1}{p(1-p)}$$

---

### 知识延伸

1.  **瓦尔德等式 (Wald's Identity)**：
    题目文本中提到的定理 4.22 是随机过程中的重要定理。它指出，若 $X_n$ 独立同分布且均值为 $E[X]$，停止时间 $J$ 满足 $E[J] < \infty$，则随机和 $S_J = \sum_{n=1}^J X_n$ 的期望满足：
    $$E[S_J] = E[X]E[J]$$
    *注意：使用该等式的前提是 $J$ 必须是关于序列 $\{X_n\}$ 的停止时间（即 $J=n$ 事件的发生仅依赖于 $X_1, \dots, X_n$）。*

2.  **思考题解答**：
    *   **掷骰子题**：掷骰子点数为 $J$（$J$ 依赖于第一次投掷，但决定了后续次数），后续 $J$ 次投掷记为 $X_1, \dots, X_J$。这里 $J$ 与后续的 $X_i$ 独立。
        $$E[S_J] = E\left[\sum_{i=1}^J X_i\right] = E[J]E[X] = 3.5 \times 3.5 = 12.25$$
    *   **首次成功题**：这是几何分布（Geometric Distribution）。成功概率为 $p$，平均试验次数为：
        $$E[J] = \frac{1}{p}$$

3.  **模式匹配的通解技巧（鞅方法/赌徒破产模型）**：
    计算任意模式 $A = (a_1, a_2, \dots, a_k)$ 首次出现的期望时间，可以使用公式：
    $$E[J] = \sum_{k=1}^{|A|} \frac{1}{P(A^{(k)})} \cdot \mathbb{I}(\text{overlap})$$
    其中求和是对所有可能的“后缀与前缀重叠”进行。
    *   对于本题 $(1, 0)$：前缀是 $1$，后缀是 $0$，无重叠。只有完全匹配本身一项。概率为 $p \times q$。故 $E[J] = \frac{1}{pq}$。
    *   若模式为 $(1, 1)$：前缀 $1$ 与后缀 $1$ 重叠。
        $$E[J] = \frac{1}{p^2} + \frac{1}{p}$$

---
